<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wasif MD Session Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Poppins,Arial}
body{
  margin:0;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  overflow:hidden;
}
.screen{
  display:none;
  height:100vh;
  width:100%;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  animation:fade .4s ease;
}
.screen.active{display:flex}
@keyframes fade{
  from{opacity:0;transform:scale(.96)}
  to{opacity:1;transform:scale(1)}
}
.card{
  width:92%;
  max-width:420px;
  background:#111c;
  padding:22px;
  border-radius:18px;
  box-shadow:0 0 30px #000;
  text-align:center;
}
h1,h2{margin:10px 0}
input,select{
  padding:14px;
  border-radius:14px;
  border:none;
  margin:6px 0;
  font-size:13px;
  color:#000;
  width:100%;
}
input::placeholder{font-size:12px}
.in1{background:linear-gradient(135deg,#ffecd2,#fcb69f)}
.in2{background:linear-gradient(135deg,#d4fc79,#96e6a1)}
.in3{background:linear-gradient(135deg,#a1c4fd,#c2e9fb)}
.in4{background:linear-gradient(135deg,#fbc2eb,#a6c1ee)}
.btn1{background:linear-gradient(135deg,#00c6ff,#0072ff)}
.btn2{background:linear-gradient(135deg,#f7971e,#ffd200)}
.btn3{background:linear-gradient(135deg,#fc5c7d,#6a82fb)}
.btn4{background:linear-gradient(135deg,#43cea2,#185a9d)}
.btn5{background:linear-gradient(135deg,#ff512f,#dd2476)}
.btn6{background:linear-gradient(135deg,#8360c3,#2ebf91)}
.btnBack{background:linear-gradient(135deg,#555,#222)}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  color:#fff;
  font-size:14px;
  margin-top:10px;
  cursor:pointer;
}
button:disabled{opacity:.4}
.small{font-size:12px;opacity:.8}
.row{display:flex;gap:8px}
.code{flex:0 0 30%}
.num{flex:1}
.codebox{
  margin-top:12px;
  background:#0008;
  padding:10px;
  border-radius:12px;
  font-size:12px;
  max-height:46px;
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}
.status{
  margin-top:10px;
  font-size:13px;
  opacity:.8;
}
</style>
</head>

<body>

<!-- WELCOME -->
<div class="screen active" id="welcome">
  <h1>Welcome To</h1>
  <h2>Wasif MD Session Section</h2>
</div>

<!-- NAME -->
<div class="screen" id="name">
  <div class="card">
    <h2>Enter Your Good Name</h2>
    <div class="row">
      <input class="in1" id="fname" placeholder="First Name">
      <input class="in2" placeholder="Last Name (Optional)">
    </div>
    <p class="small">Example: Muzammil Khan</p>
    <button class="btn1" id="nameBtn" disabled>Submit</button>
  </div>
</div>

<!-- HOME -->
<div class="screen" id="home">
  <div class="card">
    <h2 id="hello"></h2>
    <button class="btn2" onclick="show('region')">Link With Phone Number</button>
    <button class="btn3" onclick="startQR()">Link With QR</button>
    <div class="status" id="conn-status">Checking connection...</div>
  </div>
</div>

<!-- REGION -->
<div class="screen" id="region">
  <div class="card">
    <button class="btnBack" onclick="show('home')">Back</button>
    <h2>Select Your Region</h2>
    <button class="btn5" onclick="openPhone('pk')">Pakistan</button>
    <button class="btn6" onclick="openPhone('all')">Other Country</button>
  </div>
</div>

<!-- PHONE -->
<div class="screen" id="phone">
  <div class="card">
    <button class="btnBack" onclick="show('region')">Back</button>
    <h2>Enter Phone Number</h2>

    <div class="row">
      <select class="in3 code" id="code"></select>
      <input class="in4 num" id="number" placeholder="Phone Number">
    </div>

    <button class="btn1" id="pairBtn" disabled onclick="realPair()">Request A Pair</button>

    <div id="pairBox" style="display:none">
      <div class="codebox" id="pairCode"></div>
      <button class="btn2" onclick="copyCode()">Copy Code</button>
    </div>

    <div id="sessionBox" style="display:none">
      <div class="codebox" id="sessionText">Waiting for session...</div>
      <button class="btn2" onclick="copySession()">Copy Session</button>
    </div>

  </div>
</div>

<script>
const screens=document.querySelectorAll('.screen');
function show(id){
  screens.forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
setTimeout(()=>show('name'),2000);

const fname=document.getElementById('fname');
const nameBtn=document.getElementById('nameBtn');
fname.oninput=()=>nameBtn.disabled=fname.value.length<2;

nameBtn.onclick=()=>{
  document.getElementById('hello').innerHTML=
    `Dear <span style="color:#00c6ff">${fname.value}</span><br>
     Welcome To Wasif MD Session Generator`;
  show('home');
};

// Phone inputs
const code=document.getElementById('code');
const number=document.getElementById('number');
const pairBtn=document.getElementById('pairBtn');
const pairBox=document.getElementById('pairBox');
const pairCode=document.getElementById('pairCode');
const sessionBox=document.getElementById('sessionBox');
const sessionText=document.getElementById('sessionText');

function openPhone(type){
  code.innerHTML= type==='pk'
    ?'<option>+92</option>'
    :'<option>+92</option><option>+1</option><option>+44</option>';
  show('phone');
}

number.oninput=()=>pairBtn.disabled=number.value.length<7;

// ðŸ”‘ Request Pair via WASI-MD backend
async function realPair(){
  const full = code.value.replace('+','') + number.value;
  try {
    const r = await fetch('/api/pair', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ phone: full })
    });
    const d = await r.json();

    if(d.code){
      pairCode.innerText = d.code;
      pairBox.style.display = 'block';
      pollSession();
    } else {
      alert(d.error || 'Pairing Failed');
    }
  } catch(e){
    alert('Network error, try again.');
  }
}

// Copy functions
function copyCode(){
  navigator.clipboard.writeText(pairCode.innerText);
}
function copySession(){
  navigator.clipboard.writeText(sessionText.innerText);
}

// Poll backend for session (WASI-MD)
async function pollSession(){
  const i=setInterval(async()=>{
    try {
      const r = await fetch('/api/status');
      const d = await r.json();
      if(d.connected){
        sessionText.innerText = d.session || 'Session Active';
        sessionBox.style.display = 'block';
        document.getElementById('conn-status').innerText = 'Connected';
        clearInterval(i);
      } else {
        document.getElementById('conn-status').innerText = 'Waiting...';
      }
    } catch(e){}
  },3000);
}

// QR integration
function startQR(){
  fetch('/api/qr',{method:'POST'})
    .then(()=>alert('QR requested. Open WASI-MD QR screen to scan.'))
    .catch(()=>alert('Failed to request QR.'));
}

// Enable pair button
number.oninput=()=>pairBtn.disabled=number.value.length<7;

// Initial status check
setInterval(async()=>{
  try{
    const res=await fetch('/api/status');
    const data=await res.json();
    document.getElementById('conn-status').innerText = data.connected ? 'Connected' : 'Waiting...';
  }catch(e){}
},2000);
</script>

</body>
</html>
