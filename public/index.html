<script>
const screens=document.querySelectorAll('.screen');
function show(id){
  screens.forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
setTimeout(()=>show('name'),3000);

// Name validation
const f=document.getElementById('fname');
const b=document.getElementById('nameBtn');
f.oninput=()=>b.disabled=!/^[A-Z][a-z]+$/.test(f.value);
b.onclick=()=>{
  document.getElementById('hello').innerHTML=
  `Dear <span style="color:#00c6ff">${f.value}</span><br>
   <span style="font-size:14px">Welcome To Wasif MD Session Generator</span>`;
  show('home');
};

// Region → Phone
function openPhone(type){
  const c=document.getElementById('code');
  c.innerHTML = type==='pk'
    ? '<option value="+92">+92</option>'
    : '<option value="+92">+92</option><option value="+1">+1</option><option value="+44">+44</option>';
  show('phone');
}

// Enable pair button
document.getElementById('number').oninput=e=>{
  document.getElementById('pairBtn').disabled = e.target.value.length < 7;
};

// ✅ REAL WHATSAPP PAIRING
async function fakePair(){
  const code = document.getElementById("code").value.replace("+","");
  const number = document.getElementById("number").value.trim();
  if(!number) return alert("Enter phone number");

  const btn = document.getElementById("pairBtn");
  btn.disabled = true;
  btn.innerText = "Requesting...";

  try{
    const res = await fetch("/pair",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ number: code + number })
    });

    const data = await res.json();

    if(data.code){
      document.getElementById("pairCode").innerText = data.code;
      document.getElementById("pairBox").style.display = "block";
    }else{
      alert("Pairing failed");
    }
  }catch(e){
    alert("Server not responding");
  }

  btn.innerText = "Request A Pair";
  btn.disabled = false;
}

function copyCode(){
  const code = document.getElementById("pairCode").innerText;
  navigator.clipboard.writeText(code);
}

function wa(n){
  window.open("https://wa.me/"+n);
}
</script>
